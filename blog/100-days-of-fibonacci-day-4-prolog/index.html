<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <script>
    // I have moved the blog
    let url = 'https://blog.madsbuch.com' + window.location.pathname.replace('/blog', '')
    window.location = url
  </script>

  <title>100 Days of Fibonacci - Day 4, Prolog</title>
  <meta name="description" content="Updates:" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@madspbuch" />
    <meta name="twitter:title" content="100 Days of Fibonacci - Day 4, Prolog" />
    <meta name="twitter:image" content="http://madsbuch.com/blog/assets/images/logo.png" />
    
    <meta name="twitter:description"  content="Updates:" />
    
  
  
  <meta property="og:site_name" content="Mads Buch" />
  <meta property="og:title" content="100 Days of Fibonacci - Day 4, Prolog"/>
  
  <meta property="og:description" content="Updates:" />
  
  <meta property="og:image" content="http://madsbuch.com/blog/assets/images/logo.png" />
  <meta property="og:url" content="http://madsbuch.com/blog/100-days-of-fibonacci-day-4-prolog/" >
  <meta property="og:type" content="blog" />

  
  <meta property="fb:app_id" content="1727612590830968" />
  
  

  <meta property="article:published_time" content="2015-12-19T00:00:00+01:00">

  <link rel="canonical" href="http://madsbuch.com/blog/100-days-of-fibonacci-day-4-prolog/"/>
  <link rel="shortcut icon" href="/blog/assets/images/favicon.png" type="image/png"/>
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/blog/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/blog/css/print.css" />
  <link rel="stylesheet" type="text/css" href="/blog/css/extra.css" />

  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3209922-9', 'auto');
  ga('send', 'pageview');

</script>
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="http://madsbuch.com/blog" class="logo-readium">
    <span class="logo" style="background-image: url(/blog/assets/images/logo.png)"></span>
</a>

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">100 Days of Fibonacci - Day 4, Prolog</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/blog/assets/images/author.png)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person"></h4>
              on
              <time datetime="2015-12-19T00:00:00+01:00">19 Dec 2015</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p><strong>Updates:</strong></p>

<ul>
  <li>26 January 2016: Complete rewrite of the section about the Structural
Implementation of Fibonacci.</li>
</ul>

<p>In my <a href="/blog/100-days-of-fibonacci-overview/">100 days of Fibonacci</a>
project I looked at functional and imperative language. There are however
many more programming paradigms today we are going to dive into
one of the most used
<a href="https://en.wikipedia.org/wiki/Logic_programming">logic programming languages</a>.</p>

<p>Prolog is heavily used in the field of artificial intelligence. This is due
to the natural way of formulating computations in terms of predicates.
This allows for concise expression of tree structures that certain data might
exhibit.</p>

<p>In this blog post, i show how to implement Fibonacci in the directly
recursive style. As we will see this gives problems when we want to
exploit some Prolog features.</p>

<h1 id="day-4---prolog">Day 4 - Prolog</h1>
<p>In Prolog, I defined a predicate that holds both the argument and the
result. A predicate is something that can only be true or false.
Therefore, the notion of return value is explicit parameters to the
predicates in Prolog.</p>

<figure class="highlight"><pre><code class="language-prolog" data-lang="prolog"><span class="err">%</span> <span class="nv">Implementation</span> <span class="ss">using</span> <span class="ss">direct</span> <span class="ss">recursion</span><span class="p">.</span>
<span class="ss">fib_direct</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">).</span>
<span class="ss">fib_direct</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">).</span>
<span class="ss">fib_direct</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span>
    <span class="nv">X1</span> <span class="ss">is</span> <span class="nv">N</span><span class="o">-</span><span class="m">1</span><span class="p">,</span>
    <span class="nv">X2</span> <span class="ss">is</span> <span class="nv">N</span><span class="o">-</span><span class="m">2</span><span class="p">,</span>
    <span class="ss">fib_direct</span><span class="p">(</span><span class="nv">X1</span><span class="p">,</span> <span class="nv">A</span><span class="p">),</span>
    <span class="ss">fib_direct</span><span class="p">(</span><span class="nv">X2</span><span class="p">,</span> <span class="nv">B</span><span class="p">),</span>
    <span class="nv">R</span> <span class="ss">is</span> <span class="nv">A</span> <span class="o">+</span> <span class="nv">B</span><span class="p">.</span></code></pre></figure>

<p>In above the base cases are defined as simple predicates. The first argument
is the nth Fibonacci number and the second is the result.</p>

<p>By writing <code class="highlighter-rouge">fib_direct(0, 0).</code> we denote that the predicate predicate
<code class="highlighter-rouge">fib_direct</code> is true when applied 0 for both arguments. In <code class="highlighter-rouge">swipl</code>
(SWI Prolog interpreter) we can write <code class="highlighter-rouge">fib_direct(0, X).</code> to make
it derive the second argument given the first argument.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>swipl fib.pl 
% fib.pl compiled 0.00 sec, 4 clauses
Welcome to SWI-Prolog ...

For <span class="nb">help</span>, use ?- <span class="nb">help</span><span class="o">(</span>Topic<span class="o">)</span><span class="nb">.</span> or ?- apropos<span class="o">(</span>Word<span class="o">)</span><span class="nb">.</span>

?- fib_direct<span class="o">(</span>0, R<span class="o">)</span><span class="nb">.</span>
R <span class="o">=</span> 0 .</code></pre></figure>

<p>The third definition of the <code class="highlighter-rouge">fib_direct</code> predicate is the one that
allows us to calculate Fibonacci for arbitrary numbers. We can again
make prolog derive the result by supplying N</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">...
?- fib_direct<span class="o">(</span>10, R<span class="o">)</span><span class="nb">.</span>
R <span class="o">=</span> 55 .</code></pre></figure>

<p>A problem here is that we use the <code class="highlighter-rouge">is/2</code> notation. It enforces evaluation
of the right side and puts the result in the variable on the left side.
This is something we want to avoid in logical programming, as we need the
right side to be defined. The reason is that we can not choose what to derive anymore.</p>

<p>Yesterday I put up a little challenge to try to figure out where 55 came from.
This challenge is ideal to solve in Prolog as we can use the
same code to derive what <em>n</em> is for a given Fibonacci number. We would have
done something like.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">?- fib_direct<span class="o">(</span>N, 55<span class="o">)</span><span class="nb">.</span>
ERROR: fib_direct/2: Arguments are not sufficiently instantiated</code></pre></figure>

<p>But as you can see it fails. This is because of the use of <code class="highlighter-rouge">is/2</code>.
The <code class="highlighter-rouge">is</code>-operator does explicit evaluation of the right-hand side
before it check whether it equals the left-hand side.</p>

<h2 id="a-structural-implementation-of-fibonacci">A Structural Implementation of Fibonacci</h2>

<p>To remove the use of that operator I have implemented Peano natural
numbers and defined what addition is. This allows us to implement
Fibonacci in a purely structural manner.</p>

<p>Fibonacci is a very simple function that requires 3 constructions:
a data type (natural numbers), data aggregation (addition), and
a way to define the recursive dependencies. That last thing is done
through recursively defined predicates in Prolog.</p>

<figure class="highlight"><pre><code class="language-prolog" data-lang="prolog"><span class="err">%</span> <span class="nv">Definiition</span> <span class="ss">of</span> <span class="ss">the</span> <span class="nv">Peano</span> <span class="ss">numbers</span>
<span class="ss">nat</span><span class="p">(</span><span class="m">0</span><span class="p">).</span>
<span class="ss">nat</span><span class="p">(</span><span class="ss">s</span><span class="p">(</span><span class="nv">_</span><span class="p">)).</span>

<span class="err">%</span> <span class="nv">Readable</span> <span class="ss">nats</span>
<span class="ss">nat_to_int</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">).</span>
<span class="ss">nat_to_int</span><span class="p">(</span><span class="ss">s</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span>
    <span class="ss">nat_to_int</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">R1</span><span class="p">),</span>
    <span class="nv">R</span> <span class="ss">is</span> <span class="nv">R1</span> <span class="o">+</span> <span class="m">1</span><span class="p">.</span>

<span class="ss">int_to_nat</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">).</span>
<span class="ss">int_to_nat</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="ss">s</span><span class="p">(</span><span class="nv">R</span><span class="p">))</span> <span class="p">:-</span>
    <span class="nv">X1</span> <span class="ss">is</span> <span class="nv">X</span><span class="o">-</span><span class="m">1</span><span class="p">,</span>
    <span class="ss">int_to_nat</span><span class="p">(</span><span class="nv">X1</span><span class="p">,</span> <span class="nv">R</span><span class="p">).</span></code></pre></figure>

<p>Above is the data type. The first three lines are somewhat unnecessary
as Prologs typing discipline is implicit.</p>

<p>The next two block display how we convert between the arithmetic integers
and the naturals. We use pattern matching an a recursively defined predicate.
This construction is quite idiomatic for this problem.</p>

<p>Net we have an implementation of addition. Again we use pattern
matching in two defined predicates. The first predicate is the
base case while the second is the induction case.</p>

<figure class="highlight"><pre><code class="language-prolog" data-lang="prolog"><span class="err">%</span> <span class="nv">Definition</span> <span class="ss">of</span> <span class="ss">addition</span> <span class="p">(</span> <span class="ss">add</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span> <span class="nv">B</span><span class="p">,</span> <span class="nv">Result</span> <span class="p">))</span>
<span class="ss">add</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="nv">B</span><span class="p">,</span> <span class="nv">B</span><span class="p">).</span>
<span class="ss">add</span><span class="p">(</span><span class="ss">s</span><span class="p">(</span><span class="nv">A</span><span class="p">),</span> <span class="nv">B</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span> <span class="ss">add</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span> <span class="ss">s</span><span class="p">(</span><span class="nv">B</span><span class="p">),</span> <span class="nv">R</span><span class="p">).</span></code></pre></figure>

<p>To understand what is happening one can think of two stacks of plates
where we move all plates piecewise from the left stack to the right.
When the left stack is empty, we stop and let the right one be the
result.</p>

<p>The last part in this implementation is the definition of Fibonacci.
Note that we implicitly subtract the number by 2 when we match in
the induction case. This is necessary as we don’t have any functionality
for subtracting. General subtraction is not necessary as we only need to
subtract by 2. In the body of the predicate we add by 1, to get the subtraction
of 1.</p>

<figure class="highlight"><pre><code class="language-prolog" data-lang="prolog"><span class="ss">fib_peano</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">).</span>
<span class="ss">fib_peano</span><span class="p">(</span><span class="ss">s</span><span class="p">(</span><span class="m">0</span><span class="p">),</span> <span class="ss">s</span><span class="p">(</span><span class="m">0</span><span class="p">)).</span>
<span class="ss">fib_peano</span><span class="p">(</span><span class="ss">s</span><span class="p">(</span><span class="ss">s</span><span class="p">(</span><span class="nv">N</span><span class="p">)),</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span>
    <span class="ss">fib_peano</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">A</span><span class="p">),</span>
    <span class="ss">fib_peano</span><span class="p">(</span><span class="ss">s</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span> <span class="nv">B</span><span class="p">),</span>
    <span class="ss">add</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span> <span class="nv">B</span><span class="p">,</span> <span class="nv">R</span><span class="p">).</span>

<span class="err">%</span> <span class="nv">Wrapper</span> <span class="ss">functions</span> <span class="ss">dealing</span> <span class="ss">with</span> <span class="ss">all</span> <span class="ss">the</span> <span class="ss">conversions</span>
<span class="ss">fib_peano_wrapper_get_res</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span> <span class="nv">B</span><span class="p">)</span> <span class="p">:-</span>
    <span class="ss">int_to_nat</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span> <span class="nv">X</span><span class="p">),</span>
    <span class="ss">fib_peano</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Y</span><span class="p">),</span>
    <span class="ss">nat_to_int</span><span class="p">(</span><span class="nv">Y</span><span class="p">,</span> <span class="nv">B</span><span class="p">).</span>
<span class="ss">fib_peano_wrapper_get_arg</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span> <span class="nv">B</span><span class="p">)</span> <span class="p">:-</span>
    <span class="ss">int_to_nat</span><span class="p">(</span><span class="nv">B</span><span class="p">,</span> <span class="nv">Y</span><span class="p">),</span>
    <span class="ss">fib_peano</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Y</span><span class="p">),</span>
    <span class="ss">nat_to_int</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">A</span><span class="p">).</span></code></pre></figure>

<p>The two last blocks are for reading arithmetic arguments. They simply
convert a number to the Peano structure before it run the <code class="highlighter-rouge">fib_peano</code>
predicate. Lastly it converts back to arithmetic integers to make it
easier to read the output.</p>

<p>First we take a look at how it would look without conversion from integers.
It is apparent that it is rather cumbersome to practically work with numbers
in this format.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">?- fib_peano<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>0<span class="o">))))))))))</span>, R<span class="o">)</span>, nat_to_int<span class="o">(</span>R, X<span class="o">)</span><span class="nb">.</span>
R <span class="o">=</span> s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>s<span class="o">(</span>...<span class="o">))))))))))</span>,
X <span class="o">=</span> 55 .</code></pre></figure>

<p>The last piece of code for this post demonstrates how the wrappers work.
the first example simply returns the 10th Fibonacci number.
The second example is more interesting. It lets us derive which
index the Fibonacci number 55 has.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">?- fib_peano_wrapper_get_res<span class="o">(</span>10, B<span class="o">)</span><span class="nb">.</span>
B <span class="o">=</span> 55 <span class="nb">.</span>

?- fib_peano_wrapper_get_arg<span class="o">(</span>A, 55<span class="o">)</span><span class="nb">.</span>
A <span class="o">=</span> 10 .</code></pre></figure>

<p>The last piece of code also solves the puzzle from 
<a href="/blog/100-days-of-fibonacci-day-3-scala/">yesterday</a>
where I asked what <em>n</em> is for <script type="math/tex">fib(n) = 55</script>.</p>

<p>The time and space complexity is generally not good when using this
representation. It is usually only used when reasoning about programs, 
i.e. proving different properties about programs. The idea about
structuring problems in terms of nothing but predicates is very
usable, and is indeed one of the reasons why Prolog is widely used.</p>

<p>As usual the files are available on
<a href="https://github.com/madsbuch/fibonacci/tree/master/prolog">Github</a>.</p>

<h1 id="programming-through-predicates">Programming Through Predicates</h1>
<p>Logic programming has its core in predicates. We define logical
propositions and make the subsystem derive what we need. This works
very well when we work on structures like lists and trees.</p>

<p>The Fibonacci function, however, works on natural numbers which
we usually represent as integers for direct translation to
machine instructions.</p>

<p>As seen above it was indeed possible to implement naturals structurally.
On a more general note, it is actually possible to model all problems in
a structural manner. This is exploited in amongst other languages
<a href="/blog/100-days-of-fibonacci-day-7-coq/">Coq</a>.</p>

<p>Actually, all problems may be expressed in structures. This we will
get back to when discussing theorem provers.</p>

<h1 id="conclusion">Conclusion</h1>
<p>Today I looked at Prolog. I implemented the Fibonacci function
in a logic context. We saw that We didn’t exploit Prologs ability
to derive the argument to Fibonacci. To circumvent that, I
built a structural implementation of natural, using Peano,
so we didn’t have to make an explicit evaluation. This implementation
had the ability to derive what number a given Fibonacci number is,
even though it is not practical.</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=100+Days+of+Fibonacci+-+Day+4%2C+Prolog&amp;url=http://madsbuch.com/blog/100-days-of-fibonacci-day-4-prolog"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/blog/assets/images/author.png)">Blog Logo</div>
              <h4>Mads Buch</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2015-12-19 00:00">19 Dec 2015</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/blog/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Mads Buch</a> &copy; 2019<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/blog/assets/images/cover.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Mads Buch</h1>
        <h2 class="blog-description">Technical articles
</h2>
        <a href="/blog" class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/blog/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/blog/assets/js/index.js"></script>
<script type="text/javascript" src="/blog/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>


  </body>
</html>
